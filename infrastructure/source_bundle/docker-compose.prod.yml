services:
  client:
    image: ${ECR_REGISTRY}/${ECR_REPOSITORY_CLIENT}:${IMAGE_TAG}
    restart: always
    ports:
      - 3000:3000
    environment:
      - NEXTAUTH_URL=${NEXTAUTH_URL}
      - NEXTAUTH_SECRET=${NEXTAUTH_SECRET}

  api:
    image: ${ECR_REGISTRY}/${ECR_REPOSITORY_API}:${IMAGE_TAG}
    restart: always
    ports:
      - 8000:8000
    environment:
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT}
      - DB_NAME=${DB_NAME}
      - DB_USERNAME=${DB_USERNAME}
      - DB_PASSWORD=${DB_PASSWORD}
      - S3_BUCKET_NAME=${S3_BUCKET_NAME}
      - SEED_SECRET=${SEED_SECRET}
      - ROOT_PATH=/api

  nginx:
    image: nginx
    restart: always
    volumes:
      - ./proxy/conf.d:/etc/nginx/conf.d
      - "${EB_LOG_BASE_DIR}/nginx:/var/log/nginx"
    ports:
      - 80:80
    depends_on:
      - api
      - client
